/**
 * –¢–µ—Å—Ç MCP Registry - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤
 */

import { config as dotenvConfig } from "dotenv";
import { resolve } from "path";
import { getMCPRegistry, getAgentRegistry } from "../agents";

dotenvConfig({ path: resolve(__dirname, "../../.env") });

async function testMCPRegistry() {
    console.warn(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    MCP REGISTRY TEST                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
`);

    const mcpRegistry = getMCPRegistry();

    // 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
    mcpRegistry.printStatus();

    // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã (—Å ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏)
    console.warn('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.warn('üü¢ –î–û–°–¢–£–ü–ù–´–ï –°–ï–†–í–ï–†–´ (ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)');
    console.warn('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');

    const available = mcpRegistry.getAvailableServers();
    if (available.length === 0) {
        console.warn('   –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á–∏ –≤ .env\n');
    } else {
        for (const server of available) {
            const freeTag = server.isFree ? 'üÜì' : 'üí∞';
            console.warn(`   ${freeTag} ${server.name.padEnd(20)} - ${server.description.substring(0, 50)}...`);
        }
        console.warn();
    }

    // 3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
    console.warn('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.warn('üìã –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –°–ï–†–í–ï–†–´ –ü–û –ê–ì–ï–ù–¢–ê–ú');
    console.warn('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');

    const categories = ['sports', 'politics', 'crypto'];
    for (const category of categories) {
        console.warn(`   üìÅ ${category.toUpperCase()}`);
        const recommended = mcpRegistry.getRecommendedServersForAgent(category);
        for (const server of recommended.slice(0, 5)) {
            const isAvailable = mcpRegistry.isServerAvailable(server.name);
            const status = isAvailable ? '‚úÖ' : '‚ùå';
            const freeTag = server.isFree ? 'üÜì' : 'üí∞';
            console.warn(`      ${status} ${freeTag} ${server.name}`);
        }
        console.warn();
    }

    // 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º AgentRegistry —Å MCP
    console.warn('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.warn('ü§ñ –°–¢–ê–¢–£–° –ê–ì–ï–ù–¢–û–í');
    console.warn('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');

    const agentRegistry = getAgentRegistry();
    agentRegistry.printMCPStatus();

    // 5. –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
    console.warn('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
    console.warn('üí° –ü–û–î–°–ö–ê–ó–ö–ò –ü–û –ù–ê–°–¢–†–û–ô–ö–ï');
    console.warn('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');

    const allServers = mcpRegistry.getAllServers();
    const unavailableWithKeys = allServers.filter(s =>
        !mcpRegistry.isServerAvailable(s.name) &&
        s.requiredEnvVars &&
        s.requiredEnvVars.length > 0
    );

    if (unavailableWithKeys.length > 0) {
        console.warn('   –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤:\n');
        const envVars = new Set<string>();
        for (const server of unavailableWithKeys) {
            for (const envVar of server.requiredEnvVars || []) {
                if (!process.env[envVar]) {
                    envVars.add(envVar);
                }
            }
        }
        for (const envVar of envVars) {
            console.warn(`   ${envVar}=your_api_key_here`);
        }
        console.warn();
    }

    // –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
    console.warn('   üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ API –∫–ª—é—á–∞–º:');
    console.warn('   ‚Ä¢ Tavily: https://tavily.com/ (1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ)');
    console.warn('   ‚Ä¢ Brave Search: https://brave.com/search/api/ (2000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ)');
    console.warn('   ‚Ä¢ CoinGecko: https://www.coingecko.com/en/api (–±–µ—Å–ø–ª–∞—Ç–Ω–æ —Å –ª–∏–º–∏—Ç–∞–º–∏)');
    console.warn('   ‚Ä¢ Alpha Vantage: https://www.alphavantage.co/ (25 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ)');
    console.warn();

    // Cleanup
    await agentRegistry.destroy();
    console.warn('‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω\n');
}

testMCPRegistry().catch(error => {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    process.exit(1);
});
